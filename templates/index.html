<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Offer Letter Extractor - Batch Mode</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f7fa; padding:20px; }
    .pdf-container { display:none; margin-bottom:20px; }
    .pdf-container.active { display:flex; gap:20px; }
    .left, .right {
      background:#fff; padding:15px; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.06);
    }
    .left { width:50%; }
    .right { width:50%; }
    iframe { width:100%; height:500px; border:1px solid #ccc; }
    label { display:block; margin-top:8px; font-weight:600; }
    input[type=text] { width:100%; padding:8px; margin-top:4px; }
    button { padding:8px 14px; margin-top:10px; cursor:pointer; }
    .nav-btns { margin-top:15px; }
  </style>
</head>
<body>
  <h1>ðŸ“„ Offer Letter Extractor (Batch Mode)</h1>

  <!-- Upload form -->
  <form action="/upload" method="post" enctype="multipart/form-data">
    <input type="file" name="file" accept=".pdf" multiple required />
    <button type="submit">Upload & Extract</button>
  </form>

  {% if error %}
    <p style="color:red;">{{ error }}</p>
  {% endif %}

  {% if results %}
    <form action="/save_all" method="post">
      {% for r in results %}
        <div class="pdf-container {% if loop.first %}active{% endif %}" id="pdf-{{ loop.index0 }}">
          <!-- PDF preview -->
          <div class="left">
            {% if r.pdf_url %}
              <iframe src="{{ r.pdf_url }}"></iframe>
            {% else %}
              <p>No PDF preview available</p>
            {% endif %}
          </div>

          <!-- Editable fields -->
          <div class="right">
            <input type="hidden" name="filename" value="{{ r.filename }}">
            <label>Name</label>
            <input type="text" name="name" value="{{ r.name or '' }}">
            <label>Company</label>
            <input type="text" name="company" value="{{ r.company or '' }}">
            <label>Salary</label>
            <input type="text" name="salary" value="{{ r.salary or '' }}">

            {% if r.error %}
              <p style="color:red;">Error: {{ r.error }}</p>
            {% endif %}

            <div class="nav-btns">
              {% if not loop.first %}
                <button type="button" onclick="showPDF({{ loop.index0 - 1 }})">â¬… Prev</button>
              {% endif %}
              {% if not loop.last %}
                <button type="button" onclick="showPDF({{ loop.index0 + 1 }})">Next âž¡</button>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}

      <!-- Save all button -->
      <button type="submit" style="margin-top:20px;">ðŸ’¾ Save All to Excel</button>
    </form>

    <script>
      function showPDF(index) {
        document.querySelectorAll('.pdf-container').forEach((el, i) => {
          el.classList.toggle('active', i === index);
        });
      }
    </script>
  {% endif %}
</body>
</html>
